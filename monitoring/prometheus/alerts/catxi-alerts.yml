groups:
- name: catxi.backend
  rules:
  - alert: ë©”ëª¨ë¦¬ì‚¬ìš©ëŸ‰ë†’ìŒ
    expr: (jvm_memory_used_bytes{job="catxi-backend-instances",area="heap"} / jvm_memory_max_bytes{job="catxi-backend-instances",area="heap"}) * 100 > 75
    for: 3m
    labels:
      severity: warning
      team: ë°±ì—”ë“œ
      service: catxi-api
      priority: P2
      impact: ì„±ëŠ¥ì €í•˜
    annotations:
      summary: "ğŸ§  ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë†’ìŒ - {{ $labels.instance }}"
      description: |
        **ë°±ì—”ë“œ ì„œë¹„ìŠ¤ ë©”ëª¨ë¦¬ ê²½ê³ **
        í˜„ì¬ ì‚¬ìš©ë¥ : {{ $value }}%
        ì„œë²„: {{ $labels.instance }}

        **ğŸ”§ í™•ì¸ì‚¬í•­:**
        â€¢ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í™•ì¸
        â€¢ GC í™œë™ ëª¨ë‹ˆí„°ë§
        â€¢ ì§€ì†ë˜ë©´ ìŠ¤ì¼€ì¼ë§ ê²€í† 

  - alert: ë©”ëª¨ë¦¬ì‚¬ìš©ëŸ‰ìœ„í—˜
    expr: (jvm_memory_used_bytes{job="catxi-backend-instances",area="heap"} / jvm_memory_max_bytes{job="catxi-backend-instances",area="heap"}) * 100 > 85
    for: 1m
    labels:
      severity: critical
      team: ë°±ì—”ë“œ
      service: catxi-api
      priority: P0
      impact: ì„œë¹„ìŠ¤ì¤‘ë‹¨ìœ„í—˜
    annotations:
      summary: "ğŸš¨ ìœ„í—˜: ë©”ëª¨ë¦¬ ê±°ì˜ ì†Œì§„ - {{ $labels.instance }}"
      description: |
        **ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”**
        ì‚¬ìš©ë¥ : {{ $value }}%
        ìœ„í—˜: ëª‡ ë¶„ ë‚´ ì„œë¹„ìŠ¤ ë‹¤ìš´ ê°€ëŠ¥

        **âš¡ ê¸´ê¸‰ ì¡°ì¹˜:**
        1. ì¦‰ì‹œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í™•ì¸
        2. í•„ìš”ì‹œ ì„œë¹„ìŠ¤ ì¬ì‹œì‘
        3. ë¡œë“œë°¸ëŸ°ì„œ íŠ¸ë˜í”½ ë¶„ì‚°
        4. ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ ëª¨ë‹ˆí„°ë§

  - alert: ì‘ë‹µì†ë„ëŠë¦¼
    expr: histogram_quantile(0.95, rate(http_server_requests_seconds_bucket{job="catxi-backend-instances"}[5m])) > 1.5
    for: 2m
    labels:
      severity: warning
      team: ë°±ì—”ë“œ
      service: catxi-api
      priority: P2
      impact: ì‚¬ìš©ìê²½í—˜ì €í•˜
    annotations:
      summary: "â±ï¸ API ì‘ë‹µ ì†ë„ ëŠë¦¼ - {{ $labels.instance }}"
      description: |
        **ì„±ëŠ¥ ì €í•˜ ê°ì§€**
        95% ì‘ë‹µì‹œê°„: {{ $value }}ì´ˆ
        ëª©í‘œ: 1.5ì´ˆ ì´í•˜

        **ğŸ” í™•ì¸ì‚¬í•­:**
        â€¢ DB ì¿¼ë¦¬ ì„±ëŠ¥ í™•ì¸
        â€¢ ì—ëŸ¬ ë¡œê·¸ ê²€í† 
        â€¢ CPU/IO ì‚¬ìš©ë¥  í™•ì¸
        â€¢ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²° í™•ì¸

  - alert: ì‘ë‹µì†ë„ë§¤ìš°ëŠë¦¼
    expr: histogram_quantile(0.95, rate(http_server_requests_seconds_bucket{job="catxi-backend-instances"}[5m])) > 3.0
    for: 1m
    labels:
      severity: critical
      team: ë°±ì—”ë“œ
      service: catxi-api
      priority: P1
      impact: ì‹¬ê°í•œì‚¬ìš©ìê²½í—˜ì €í•˜
    annotations:
      summary: "ğŸš¨ ìœ„í—˜: ê·¹ë„ë¡œ ëŠë¦° ì‘ë‹µì†ë„ - {{ $labels.instance }}"
      description: |
        **ì‹¬ê°í•œ ì„±ëŠ¥ ë¬¸ì œ**
        95% ì‘ë‹µì‹œê°„: {{ $value }}ì´ˆ
        ì‚¬ìš©ì ê²½í—˜: ì‹¬ê°í•˜ê²Œ ì €í•˜ë¨

        **âš¡ ì¦‰ì‹œ ì¡°ì¹˜:**
        1. ê·¹ì‹¬í•œ ë¶€í•˜ ìƒíƒœ í™•ì¸
        2. ë¸”ë¡œí‚¹ ì‘ì—… ì¡°ì‚¬
        3. ê¸´ê¸‰ íŠ¸ë˜í”½ ìš°íšŒ ê²€í† 
        4. ì‹œë‹ˆì–´ ê°œë°œì ì—ìŠ¤ì»¬ë ˆì´ì…˜

- name: catxi.backend.availability
  rules:
  - alert: ì„œë²„ë‹¤ìš´
    expr: up{job="catxi-backend-instances"} == 0
    for: 30s
    labels:
      severity: critical
      team: ë°±ì—”ë“œ
      service: catxi-api
      priority: P0
      impact: ì„œë¹„ìŠ¤ì¤‘ë‹¨
    annotations:
      summary: "ğŸš¨ ë°±ì—”ë“œ ì„œë²„ ë‹¤ìš´ - {{ $labels.instance }}"
      description: |
        **ì„œë¹„ìŠ¤ ì¤‘ë‹¨**
        ì„œë²„: {{ $labels.instance }}
        ì§€ì†ì‹œê°„: 30ì´ˆ ì´ìƒ

        **âš¡ ê¸´ê¸‰ ëŒ€ì‘:**
        1. AWS ì½˜ì†”ì—ì„œ ì¸ìŠ¤í„´ìŠ¤ ìƒíƒœ í™•ì¸
        2. Docker ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
        3. ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ í™•ì¸
        4. ë¡œë“œë°¸ëŸ°ì„œ íŠ¸ë˜í”½ ë¦¬ë‹¤ì´ë ‰ì…˜ í™•ì¸
        5. í•„ìš”ì‹œ ìƒˆ ì¸ìŠ¤í„´ìŠ¤ ì‹¤í–‰

  - alert: ì—ëŸ¬ìœ¨ë†’ìŒ
    expr: (rate(http_server_requests_seconds_count{job="catxi-backend-instances",status=~"5.."}[5m]) / rate(http_server_requests_seconds_count{job="catxi-backend-instances"}[5m])) * 100 > 5
    for: 2m
    labels:
      severity: warning
      team: ë°±ì—”ë“œ
      service: catxi-api
      priority: P1
      impact: ì‚¬ìš©ìì˜í–¥
    annotations:
      summary: "âš ï¸ 5xx ì—ëŸ¬ìœ¨ ë†’ìŒ - {{ $labels.instance }}"
      description: |
        **ì„œë²„ ì—ëŸ¬ ì¦ê°€ ê°ì§€**
        ì—ëŸ¬ìœ¨: {{ $value }}%
        ì„œë²„: {{ $labels.instance }}

        **ğŸ” í™•ì¸ì‚¬í•­:**
        â€¢ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ì—ì„œ ì˜ˆì™¸ í™•ì¸
        â€¢ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸
        â€¢ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥  ëª¨ë‹ˆí„°ë§
        â€¢ ìµœê·¼ ë°°í¬ ë‚´ì—­ í™•ì¸

  - alert: ì—ëŸ¬ìœ¨ìœ„í—˜
    expr: (rate(http_server_requests_seconds_count{job="catxi-backend-instances",status=~"5.."}[5m]) / rate(http_server_requests_seconds_count{job="catxi-backend-instances"}[5m])) * 100 > 15
    for: 1m
    labels:
      severity: critical
      team: ë°±ì—”ë“œ
      service: catxi-api
      priority: P0
      impact: ì‹¬ê°í•œì„œë¹„ìŠ¤ì¥ì• 
    annotations:
      summary: "ğŸš¨ ìœ„í—˜: ì‹¬ê°í•œ ì—ëŸ¬ìœ¨ - {{ $labels.instance }}"
      description: |
        **ì‹¬ê°í•œ ì„œë¹„ìŠ¤ ì¥ì• **
        ì—ëŸ¬ìœ¨: {{ $value }}%
        ì‚¬ìš©ì ì˜í–¥: ë†’ì€ ì‹¤íŒ¨ìœ¨

        **âš¡ ê¸´ê¸‰ ì¡°ì¹˜:**
        1. ì¦‰ì‹œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ í™•ì¸
        2. ìµœê·¼ ë°°í¬ ë¡¤ë°± ê²€í† 
        3. ê°€ëŠ¥í•˜ë©´ íŠ¸ë˜í”½ ìš°íšŒ
        4. ë‹´ë‹¹ ì—”ì§€ë‹ˆì–´ ì—ìŠ¤ì»¬ë ˆì´ì…˜

- name: catxi.backend.resources
  rules:
  - alert: DBì»¤ë„¥ì…˜í’€ë†’ìŒ
    expr: (hikaricp_connections_active{job="catxi-backend-instances"} / hikaricp_connections_max{job="catxi-backend-instances"}) > 0.7
    for: 3m
    labels:
      severity: warning
      team: ë°±ì—”ë“œ
      service: catxi-api
      priority: P2
      impact: ì„±ëŠ¥ì €í•˜
    annotations:
      summary: "ğŸ”— DB ì»¤ë„¥ì…˜ í’€ ì‚¬ìš©ë¥  ë†’ìŒ - {{ $labels.instance }}"
      description: |
        **ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€ ê²½ê³ **
        ì‚¬ìš©ë¥ : {{ $value }}%
        ìµœëŒ€: {{ .Labels.hikaricp_connections_max }}

        **ğŸ” í™•ì¸ì‚¬í•­:**
        â€¢ ì¥ì‹œê°„ ì‹¤í–‰ íŠ¸ëœì­ì…˜ í™•ì¸
        â€¢ ì»¤ë„¥ì…˜ ëˆ„ìˆ˜ í™•ì¸
        â€¢ DB ì¿¼ë¦¬ ì„±ëŠ¥ í™•ì¸
        â€¢ ì»¤ë„¥ì…˜ í’€ ì„¤ì • íŠœë‹

  - alert: ìš”ì²­ëŸ‰ì ìŒ
    expr: rate(http_server_requests_seconds_count{job="catxi-backend-instances"}[10m]) < 0.01
    for: 5m
    labels:
      severity: info
      team: ë°±ì—”ë“œ
      service: catxi-api
      priority: P3
      impact: ëª¨ë‹ˆí„°ë§ì •ë³´
    annotations:
      summary: "ğŸ“Š ìš”ì²­ëŸ‰ ì ìŒ - {{ $labels.instance }}"
      description: |
        **ëª¨ë‹ˆí„°ë§ ì•ˆë‚´**
        ìš”ì²­ìœ¨: {{ $value }} req/sec
        ê°€ëŠ¥í•œ ì›ì¸:
        â€¢ ì •ìƒì ì¸ ì €íŠ¸ë˜í”½ ì‹œê°„ëŒ€
        â€¢ ë¡œë“œë°¸ëŸ°ì„œ ë¼ìš°íŒ… ë¬¸ì œ
        â€¢ í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ë¬¸ì œ

        **ì°¸ê³ :** ëŒ€í•™ìƒ ì„œë¹„ìŠ¤ íŠ¹ì„±ìƒ ìˆ˜ì—…ì‹œê°„ ì™¸ì—ëŠ” ì •ìƒ

  - alert: GCì‹œê°„ë†’ìŒ
    expr: rate(jvm_gc_collection_seconds_sum{job="catxi-backend-instances"}[5m]) > 0.1
    for: 2m
    labels:
      severity: warning
      team: ë°±ì—”ë“œ
      service: catxi-api
      priority: P2
      impact: ì„±ëŠ¥ì €í•˜
    annotations:
      summary: "ğŸ—‘ï¸ GC ì‹œê°„ ê¸¸ì–´ì§ - {{ $labels.instance }}"
      description: |
        **ê°€ë¹„ì§€ ì»¨ë ‰ì…˜ ì„±ëŠ¥ ë¬¸ì œ**
        GC ì‹œê°„: {{ $value }}ì´ˆ/ì´ˆ
        ì‘ë‹µ ì§€ì—°ì„ ì¼ìœ¼í‚¬ ìˆ˜ ìˆìŒ

        **ğŸ”§ ì¡°ì¹˜ì‚¬í•­:**
        â€¢ ë©”ëª¨ë¦¬ í• ë‹¹ íŒ¨í„´ ê²€í† 
        â€¢ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í™•ì¸
        â€¢ GC íŠ¸ë‹ íŒŒë¼ë¯¸í„° ê²€í† 
        â€¢ í™ ì‚¬ìš©ë¥  ì¶”ì„¸ ëª¨ë‹ˆí„°ë§

- name: catxi.infrastructure.system
  rules:
  - alert: ì‹œìŠ¤í…œCPUë†’ìŒ
    expr: 100 - (avg(rate(node_cpu_seconds_total{job="node-exporter",mode="idle"}[5m])) * 100) > 70
    for: 3m
    labels:
      severity: warning
      team: ì¸í”„ë¼
      service: ëª¨ë‹ˆí„°ë§
      priority: P2
      impact: ì„±ëŠ¥ì €í•˜
    annotations:
      summary: "ğŸ–¥ï¸ CPU ì‚¬ìš©ë¥  ë†’ìŒ - ëª¨ë‹ˆí„°ë§ ì„œë²„"
      description: |
        **ì¸í”„ë¼ ë¦¬ì†ŒìŠ¤ ê²½ê³ **
        CPU ì‚¬ìš©ë¥ : {{ $value }}%
        ì„œë²„: ëª¨ë‹ˆí„°ë§ ì„œë²„

        **ğŸ” í™•ì¸ì‚¬í•­:**
        â€¢ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ í™•ì¸
        â€¢ ì»¨í…Œì´ë„ˆ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥  ê²€í† 
        â€¢ ë¹„ì •ìƒ í™œë™ ëª¨ë‹ˆí„°ë§
        â€¢ ë¦¬ì†ŒìŠ¤ ìŠ¤ì¼€ì¼ë§ ê²€í† 

  - alert: ì‹œìŠ¤í…œCPUìœ„í—˜
    expr: 100 - (avg(rate(node_cpu_seconds_total{job="node-exporter",mode="idle"}[5m])) * 100) > 85
    for: 1m
    labels:
      severity: critical
      team: ì¸í”„ë¼
      service: ëª¨ë‹ˆí„°ë§
      priority: P1
      impact: ì‹œìŠ¤í…œë¶ˆì•ˆì •
    annotations:
      summary: "ğŸš¨ ìœ„í—˜: CPU ê³ ê°ˆ - ëª¨ë‹ˆí„°ë§ ì„œë²„"
      description: |
        **ì¤‘ìš” ë¦¬ì†ŒìŠ¤ ë¬¸ì œ**
        CPU ì‚¬ìš©ë¥ : {{ $value }}%
        ìœ„í—˜: ì‹œìŠ¤í…œ ë¶ˆì•ˆì •

        **âš¡ ê¸´ê¸‰ ì¡°ì¹˜:**
        1. ë¦¬ì†ŒìŠ¤ ì§‘ì•½ì  í”„ë¡œì„¸ìŠ¤ ì‹ë³„
        2. í•„ìˆ˜ ì•„ë‹Œ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ê²€í† 
        3. ì‹œìŠ¤í…œ ìŠ¤ì¼€ì¼ë§ ë˜ëŠ” ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš
        4. ì‹œìŠ¤í…œ ì¶©ëŒ ëª¨ë‹ˆí„°ë§

  - alert: ì‹œìŠ¤í…œë©”ëª¨ë¦¬ë†’ìŒ
    expr: (node_memory_MemTotal_bytes{job="node-exporter"} - node_memory_MemAvailable_bytes{job="node-exporter"}) / node_memory_MemTotal_bytes{job="node-exporter"} * 100 > 80
    for: 2m
    labels:
      severity: warning
      team: ì¸í”„ë¼
      service: ëª¨ë‹ˆí„°ë§
      priority: P2
      impact: ì„±ëŠ¥ì €í•˜
    annotations:
      summary: "ğŸ’¾ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  ë†’ìŒ - ëª¨ë‹ˆí„°ë§ ì„œë²„"
      description: |
        **ì‹œìŠ¤í…œ ë©”ëª¨ë¦¬ ê²½ê³ **
        ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : {{ $value }}%
        ì‚¬ìš©ê°€ëŠ¥: {{ (1024*1024*1024) - .Value }}ë°”ì´íŠ¸

        **ğŸ” í™•ì¸ì‚¬í•­:**
        â€¢ ì»¨í…Œì´ë„ˆ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ 
        â€¢ ì• í”Œë¦¬ì¼€ì´ì…˜ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜
        â€¢ ë¶ˆí•„ìš”í•œ ì„œë¹„ìŠ¤ ì‹¤í–‰ ì¤‘
        â€¢ ë©”ëª¨ë¦¬ ìµœì í™” ê²€í† 

- name: catxi.infrastructure.dependencies
  rules:
  - alert: Redisì„œë²„ë‹¤ìš´
    expr: up{job="redis-exporter"} == 0
    for: 1m
    labels:
      severity: critical
      team: ì¸í”„ë¼
      service: redis
      priority: P0
      impact: ì„œë¹„ìŠ¤ì¤‘ë‹¨ìœ„í—˜
    annotations:
      summary: "ğŸš¨ Redis ì„œë²„ ë‹¤ìš´"
      description: |
        **ì¤‘ìš” ì˜ì¡´ì„± ì„œë¹„ìŠ¤ ì¥ì• **
        ì„œë¹„ìŠ¤: Redis ìº ì‹œ
        ì˜í–¥: ë°±ì—”ë“œ ê¸°ëŠ¥ ì‹¬ê°í•œ ì˜í–¥

        **âš¡ ê¸´ê¸‰ ëŒ€ì‘:**
        1. Redis ì»¨í…Œì´ë„ˆ/ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
        2. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„± í™•ì¸
        3. Redis ë¡œê·¸ ì—ëŸ¬ ê²€í† 
        4. í•„ìš”ì‹œ Redis ì„œë¹„ìŠ¤ ì¬ì‹œì‘
        5. ë°±ì—”ë“œ ì—ëŸ¬ìœ¨ ëª¨ë‹ˆí„°ë§

  - alert: Redisë©”ëª¨ë¦¬ë†’ìŒ
    expr: redis_memory_used_bytes{job="redis-exporter"} / redis_memory_max_bytes{job="redis-exporter"} * 100 > 80
    for: 2m
    labels:
      severity: warning
      team: ì¸í”„ë¼
      service: redis
      priority: P2
      impact: ì„±ëŠ¥ì €í•˜
    annotations:
      summary: "ğŸ“Š Redis ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  ë†’ìŒ"
      description: |
        **Redis ë©”ëª¨ë¦¬ ê²½ê³ **
        ì‚¬ìš©ë¥ : {{ $value }}%

        **ğŸ” ì¡°ì¹˜ì‚¬í•­:**
        â€¢ í‚¤ ë§Œë£Œ ì •ì±… ê²€í† 
        â€¢ ëŒ€ìš©ëŸ‰ í‚¤ í™•ì¸
        â€¢ ë©”ëª¨ë¦¬ ìµœì í™” ê²€í† 
        â€¢ ì œê±° í†µê³„ ëª¨ë‹ˆí„°ë§

- name: catxi.infrastructure.monitoring
  rules:
  - alert: Prometheusë‹¤ìš´
    expr: up{job="prometheus"} == 0
    for: 30s
    labels:
      severity: critical
      team: ì¸í”„ë¼
      service: prometheus
      priority: P1
      impact: ëª¨ë‹ˆí„°ë§ì¤‘ë‹¨
    annotations:
      summary: "ğŸš¨ Prometheus ëª¨ë‹ˆí„°ë§ ì¤‘ë‹¨"
      description: |
        **ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì¥ì• **
        ìœ„í—˜: ì‹œìŠ¤í…œ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ë¶ˆê°€

        **âš¡ ì¦‰ì‹œ ì¡°ì¹˜:**
        1. Prometheus ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
        2. ì„¤ì • íŒŒì¼ í™•ì¸
        3. ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ê²€í† 
        4. ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ ì¦ì‹œ ë³µêµ¬
        5. ë°±ì—… ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ í™•ì¸

  - alert: AlertManagerë‹¤ìš´
    expr: up{job="alertmanager"} == 0
    for: 1m
    labels:
      severity: critical
      team: ì¸í”„ë¼
      service: alertmanager
      priority: P1
      impact: ì•Œë¦¼ì¤‘ë‹¨
    annotations:
      summary: "ğŸš¨ AlertManager ë‹¤ìš´ - ì•Œë¦¼ ì¤‘ë‹¨!"
      description: |
        **ì•Œë¦¼ ì‹œìŠ¤í…œ ì¥ì• **
        ìœ„í—˜: ì•Œë¦¼ì´ ì „ì†¡ë˜ì§€ ì•ŠìŒ

        **âš¡ ê¸´ê¸‰ ëŒ€ì‘:**
        1. ì¦‰ì‹œ AlertManager ìƒíƒœ í™•ì¸
        2. Discord ì›¹í›… ì—°ê²°ì„± í™•ì¸
        3. ì•Œë¦¼ ì‹œìŠ¤í…œ ë³µêµ¬
        4. ì•Œë¦¼ ì „ì†¡ í…ŒìŠ¤íŠ¸
        5. ìˆ˜ë¦¬ ì™„ë£Œì‹œê¹Œì§€ ëŒ€ì²´ ì±„ë„ë¡œ ëª¨ë‹ˆí„°ë§
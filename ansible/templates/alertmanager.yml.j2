global:
  resolve_timeout: 5m

route:
  group_by: ['alertname', 'team', 'service', 'severity']
  group_wait: 10s
  group_interval: 30s
  repeat_interval: 4h
  receiver: 'catxi-default'
  routes:
  # Critical alerts - immediate notification
  - match:
      severity: critical
    receiver: 'catxi-critical'
    repeat_interval: 2m
    group_wait: 5s
  # Warning alerts - less frequent
  - match:
      severity: warning
    receiver: 'catxi-warning'
    repeat_interval: 30m
  # Info alerts - low frequency
  - match:
      severity: info
    receiver: 'catxi-info'
    repeat_interval: 2h

receivers:
- name: 'catxi-default'
{% if lookup('env', 'DISCORD_WEBHOOK_URL') %}
  discord_configs:
  - webhook_url: '{{ lookup("env", "DISCORD_WEBHOOK_URL") }}'
    send_resolved: true
    title: "ğŸ”” Catxi ì•Œë¦¼"
    content: |
      {% raw %}**{{ .GroupLabels.severity }} ì•Œë¦¼ - {{ .GroupLabels.team }} íŒ€**

      **ğŸ“Š ì„œë¹„ìŠ¤:** {{ .GroupLabels.service }}
      **â° ì‹œê°„:** {{ .StartsAt.Format "15:04:05" }}

      {{ range .Alerts }}**{{ .Annotations.summary }}**
      {{ .Annotations.description }}
      ---{{ end }}{% endraw %}
{% else %}
  webhook_configs: []
{% endif %}

- name: 'catxi-critical'
{% if lookup('env', 'DISCORD_WEBHOOK_URL') %}
  discord_configs:
  - webhook_url: '{{ lookup("env", "DISCORD_WEBHOOK_URL") }}'
    send_resolved: true
    title: "ğŸš¨ ê¸´ê¸‰ ì¥ì•  ì•Œë¦¼"
    content: |
      {% raw %}@everyone **CRITICAL ALERT**

      **ğŸ¯ ì„œë¹„ìŠ¤:** {{ .GroupLabels.service }}
      **ğŸ‘¥ ë‹´ë‹¹íŒ€:** {{ .GroupLabels.team }}
      **â° ë°œìƒì‹œê°„:** {{ .StartsAt.Format "15:04:05" }}
      **ğŸ”¥ ìš°ì„ ìˆœìœ„:** {{ .GroupLabels.priority | default "P0" }}

      {{ range .Alerts }}**âš¡ {{ .Annotations.summary }}**
      {{ .Annotations.description }}
      {{ if .Annotations.runbook_url }}
      **ğŸ“– ëŒ€ì‘ê°€ì´ë“œ:** {{ .Annotations.runbook_url }}{{ end }}
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•{{ end }}{% endraw %}
{% else %}
  webhook_configs: []
{% endif %}

- name: 'catxi-warning'
{% if lookup('env', 'DISCORD_WEBHOOK_URL') %}
  discord_configs:
  - webhook_url: '{{ lookup("env", "DISCORD_WEBHOOK_URL") }}'
    send_resolved: true
    title: "âš ï¸ ê²½ê³  ì•Œë¦¼"
    content: |
      {% raw %}**{{ .GroupLabels.team }} íŒ€ ê²½ê³ **

      **ğŸ·ï¸ ì„œë¹„ìŠ¤:** {{ .GroupLabels.service }}
      **ğŸ“Š ìš°ì„ ìˆœìœ„:** {{ .GroupLabels.priority | default "P2" }}
      **â° ë°œìƒì‹œê°„:** {{ .StartsAt.Format "15:04:05" }}

      {{ range .Alerts }}**âš ï¸ {{ .Annotations.summary }}**
      {{ .Annotations.description }}
      {{ if .Annotations.runbook_url }}
      **ğŸ“– ëŒ€ì‘ê°€ì´ë“œ:** {{ .Annotations.runbook_url }}{{ end }}
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€{{ end }}{% endraw %}
{% else %}
  webhook_configs: []
{% endif %}

- name: 'catxi-info'
{% if lookup('env', 'DISCORD_WEBHOOK_URL') %}
  discord_configs:
  - webhook_url: '{{ lookup("env", "DISCORD_WEBHOOK_URL") }}'
    send_resolved: true
    title: "â„¹ï¸ ëª¨ë‹ˆí„°ë§ ì •ë³´"
    content: |
      {% raw %}**{{ .GroupLabels.team }} íŒ€ ì •ë³´**

      **ì„œë¹„ìŠ¤:** {{ .GroupLabels.service }}
      **ì‹œê°„:** {{ .StartsAt.Format "15:04:05" }}

      {{ range .Alerts }}{{ .Annotations.summary }}
      {{ .Annotations.description }}{{ end }}{% endraw %}
{% else %}
  webhook_configs: []
{% endif %}

inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']